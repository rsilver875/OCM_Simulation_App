<!doctype html>
<html>
<head><meta charset="utf-8"><title>GitHub OAuth Callback</title></head>
<body>
  <p>Completing sign-in... You can safely close this window after it closes automatically.</p>
  <script>
    (function() {
      function parseQuery(q) {
        return q.replace(/^\?/, '').split('&').filter(Boolean).reduce((acc, kv) => {
          const [k,v] = kv.split('=');
          acc[decodeURIComponent(k)] = decodeURIComponent(v || '');
          return acc;
        }, {});
      }
      const params = parseQuery(window.location.search);
      const code = params.code;
      const state = params.state;
      if (code && window.opener) {
        // Post code to opener (opener verifies state)
        window.opener.postMessage({ type: 'github_oauth', code: code, state: state }, '*');
        // Give opener a moment then close
        setTimeout(() => window.close(), 700);
      } else {
        document.body.innerText = 'Missing code or opener.';
      }
    })();
  </script>
</body>
</html>
